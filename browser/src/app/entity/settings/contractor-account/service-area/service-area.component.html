<div class="loader" *ngIf="fetching$ | async" [cvSpinner]="true" [cvSpinnerSize]="32"></div>

<imp-coverage-configuration
  [fetching]="fetching$ | async"
  [isUnsavedChanges]="unsavedChanges$ | async"
  [companyCoverageConfig]="companyCoverageConfig"
  [servedZipCodes]="servedZipCodes"
  (showTutorial)="onShowCoverageTutorial()"
  (onCirclePropsChanged)="onCompanyCirclePropsChanged($event)"
  (onZipCodeFound)="onZipCodeFound($event)"
  (modeChange)="onModeChanged($event)"
></imp-coverage-configuration>

<imp-coverage-sidebar
  [isDetailMode]="isDetailMode"
  [zipHistory]="zipsHistory"
  [isUnsavedChanges]="unsavedChanges$ | async"
  (undoHistory)="undo($event)"
></imp-coverage-sidebar>

<imp-coverage-tutorial></imp-coverage-tutorial>

<agm-map class="map-wrapper"
         [zoom]="mapOptions.zoom"
         (mapReady)="onMapReady($event)"
         [maxZoom]="mapOptions.maxZoom"
         [minZoom]="mapOptions.minZoom"
         [styles]="mapStyles"
         [streetViewControl]="false"
         [disableDefaultUI]="true"
         [zoomControl]="false">
  <agm-snazzy-info-window [isOpen]="infoWindow?.trigger"
                          [latitude]="infoWindow ? infoWindow.position.lat : 0"
                          [longitude]="infoWindow ? infoWindow.position.lng : 0"
                          [maxWidth]="40"
                          [maxHeight]="30"
                          [closeOnMapClick]="true"
                          [panOnOpen]="false">
    <ng-template>
      <div class="si-zip-content">{{ infoWindow?.content }}</div>
    </ng-template>
  </agm-snazzy-info-window>
</agm-map>

<div class="action-bar" [ngClass]="{'-showed': unsavedChanges$ | async}">
  <div class="container-wide">
    <div class="row -no-mar">
      <button cv-button-empty flatStyle="dark" (click)="reset()">Cancel</button>
      <div class="spacer"></div>
      <button cv-button-empty (click)="saveChanges()" [loading]="isSavingChanges" [spinnerColor]="'#14ABE3'"
              [disabled]="!(unsavedChanges$ | async)">Save
      </button>
    </div>
  </div>
</div>
