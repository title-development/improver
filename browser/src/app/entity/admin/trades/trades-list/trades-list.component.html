<div class="panel-header">
  <h1>Trades</h1>
  <div class="table-header-buttons">
    <button type="button" pButton icon="fa fa-plus" label="Add" class="ui-button-success" routerLink="new" *ngIf="securityService.hasRole(Role.ADMIN)"></button>
    <button type="button" pButton icon="pi pi-fw pi-refresh" label="&nbsp;&nbsp;Refresh" (click)="refresh()"></button>
  </div>
</div>
<p-dataTable [value]="trades.content"
             sortMode="single"
             selectionMode="single"
             [lazy]="true"
             [loading]="fetching"
             [rows]="rowsPerPage[0]"
             [filters]="filters"
             sortField="name"
             [sortOrder]="1"
             [paginator]="true"
             [contextMenu]="cm" [responsive]="true"
             [totalRecords]="trades.totalElements" [rowsPerPageOptions]="rowsPerPage"
             (onLazyLoad)="loadTradesLazy($event)"
             (onContextMenuSelect)="selectTrade($event)"
             #dt
             [expandableRows]="true" (onRowSelect)="expandRow($event)"
>
  <p-column field="id" header="ID" [filter]="true" [sortable]="true"></p-column>
  <p-column field="imageUrl" header="Image" [sortable]="true">
    <ng-template pTemplate="body" let-col let-trade="rowData">
      <div *ngIf="trade[col.field]" class="image-preview"
           (click)="showTradeImage($event,trade,op3);"
           [ngStyle]="{'background-image': 'url('+trade[col.field]+')'}"></div>
      <div *ngIf="!trade[col.field]">No image</div>
    </ng-template>
  </p-column>
  <p-column field="name" header="Name" [filter]="true" [sortable]="true"></p-column>
  <p-column field="description" header="Description" [filter]="true" [sortable]="true"></p-column>
  <p-column field="rating" header="Rating ({{ratingFilter[0]}} - {{ratingFilter[1]}})" [sortable]="true" [filter]="true">
    <ng-template pTemplate="filter" let-col>
      <i class="pi pi-close" (click)="clearRatingFilter(col, dt)"></i>
      <p-slider [style]="{'width':'100%','margin-top':'8px'}" [(ngModel)]="ratingFilter" [min]="minRatingValue" [max]="maxRatingValue" [step]="1" [range]="true" (onChange)="onRatingFilterChange($event, dt, col)"></p-slider>
    </ng-template>
  </p-column>
  <ng-template let-data pTemplate="rowexpansion">
    <div class="ui-grid ui-grid-responsive ui-fluid">
      <div class="ui-grid-row">
        <div class="ui-grid-col-9">
          <div class="ui-grid ui-grid-responsive ui-grid-pad" style="text-align: left">
            <div class="service-types-list">
              <h4>Service types</h4>
              <ng-container *ngFor="let serviceType of data.serviceTypes">
                <a [routerLink]="['/', 'admin', 'services', serviceType.id]">{{serviceType.name}}</a> <br>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</p-dataTable>
<p-contextMenu #cm [model]="contextMenuItems"></p-contextMenu>
<p-overlayPanel #op3>
  <img [src]="selectedTrade.imageUrl" *ngIf="selectedTrade"/>
</p-overlayPanel>
