<ng-container *ngIf="company">
  <div class="ui-grid ui-grid-responsive project-information">
    <div class="ui-grid-row">
      <div class="ui-g-6 ui-md-6">
        <p-card title="Details" header="Details">
          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Company logo
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                <div class="icon" [ngStyle]="company.iconUrl && company.iconUrl != '' && {'background-image':'url(' + company.iconUrl + ')'} || {'background-image':'url(/assets/img/company-logo-placeholder.png)'}"></div>
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Name
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.name}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Balance
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.balance / 100 | currency:'USD'}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Description
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.description}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Founded
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.founded | date: 'MMM d, y'}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Created
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.created | date: 'MMM d, y'}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Updated
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.updated | date: 'MMM d, ya'}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Rating
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                {{company.rating}}
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Approved
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                <i class="pi pi-check" *ngIf="company.isApproved"></i>
                <i class="pi pi-ban" *ngIf="!company.isApproved"></i>
              </div>
            </div>
            <div class="ui-g-12 ui-md-12 ui-g-nopad">
              <div class="ui-g-4 ui-md-4 ui-g-nopad">
                Site url
              </div>
              <div class="ui-g-8 ui-md-8 ui-g-nopad">
                <ng-container *ngIf="company.siteUrl">
                  <a [href]="company.siteUrl">{{company.siteUrl}}</a>
                </ng-container>
              </div>
            </div>
          </div>
        </p-card>
      </div>
      <div class="ui-g-6 ui-md-6 ui-g-nopad">
        <div class="ui-grid-row">
          <div class="ui-g-12 ui-md-12">
            <p-card title="Contact information" header="Contact information">
              <div class="ui-g">
                <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
                  <div class="ui-g-4 ui-md-4 ui-g-nopad">
                    Email
                  </div>
                  <div class="ui-g-8 ui-md-8 ui-g-nopad">
                    <span *ngIf="company.contractors">{{company.contractors[0]?.email}}</span>
                  </div>
                </div>
                <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
                  <div class="ui-g-4 ui-md-4 ui-g-nopad">
                    Address
                  </div>
                  <div class="ui-g-8 ui-md-8 ui-g-nopad">
                    {{company.location.streetAddress}}, {{company.location.city}}, {{company.location.state}}
                    {{company.location.zip}}
                  </div>
                </div>
                <div class="ui-g-12 ui-md-12 ui-g-nopad ui-grid-space">
                  <div class="ui-g-4 ui-md-4 ui-g-nopad">
                    Phone
                  </div>
                  <div class="ui-g-8 ui-md-8 ui-g-nopad">
                    <span *ngIf="company.contractors">{{company.contractors[0]?.internalPhone}}</span>
                  </div>
                </div>
              </div>
            </p-card>
          </div>
        </div>
        <div class="ui-grid-row">
          <div class="ui-g-12 ui-md-12">
            <p-card title="Licenses" header="Licenses">
              <div class="ui-g">
                <div class="ui-g-12 ui-md-12 ui-g-nopad licenses-wrapper">
                  <ng-container *ngFor="let license of company.licenses">
                    <div class="license">
                      <div class="ui-g-12 ui-md-12 ui-g-nopad">
                        <div class="ui-g-4 ui-md-4 ui-g-nopad">
                          Accreditation
                        </div>
                        <div class="ui-g-8 ui-md-8 ui-g-nopad">
                          {{license.accreditation}}
                        </div>
                      </div>
                      <div class="ui-g-12 ui-md-12 ui-g-nopad">
                        <div class="ui-g-4 ui-md-4 ui-g-nopad">
                          Expired
                        </div>
                        <div class="ui-g-8 ui-md-8 ui-g-nopad">
                          {{license.expired}}
                        </div>
                      </div>
                      <div class="ui-g-12 ui-md-12 ui-g-nopad">
                        <div class="ui-g-4 ui-md-4 ui-g-nopad">
                          Number
                        </div>
                        <div class="ui-g-8 ui-md-8 ui-g-nopad">
                          {{license.number}}
                        </div>
                      </div>
                      <div class="ui-g-12 ui-md-12 ui-g-nopad">
                        <div class="ui-g-4 ui-md-4 ui-g-nopad">
                          State
                        </div>
                        <div class="ui-g-8 ui-md-8 ui-g-nopad">
                          {{license.state}}
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </p-card>
          </div>
        </div>
      </div>
    </div>
    <div class="ui-grid-row">
      <div class="ui-g-12 ui-md-12">
        <p-accordion [multiple]="true" (onOpen)="onTabOpen($event)" (onClose)="onTabClose($event)">
          <p-accordionTab header="Offered Services">
            <p-table *ngIf="accordionControls[0].active" [(first)]="accordionControls[0].first" [value]="offeredServicesPage.content"
                         sortMode="single"
                         [lazy]="true"
                         sortField="name"
                         [rows]="rowsPerPage[0]" [totalRecords]="offeredServicesPage.totalElements" [rowsPerPageOptions]="rowsPerPage"
                         (onLazyLoad)="loadLazy($event, getCompanyServices)"
                         [paginator]="true"
                         [responsive]="true">

              <ng-template pTemplate="header" let-columns>
                <tr>
                    <th pSortableColumn="s.name">
                      Name
                      <p-sortIcon field="s.name"></p-sortIcon>
                    </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row let-columns="columns">
                <tr [pContextMenuRow]="row">
                  <td>
                    <span>{{row.name}}</span>
                  </td>
                </tr>
              </ng-template>

            </p-table>

          </p-accordionTab>
          <p-accordionTab header="Transactions">
            <p-table *ngIf="accordionControls[1].active" [(first)]="accordionControls[0].first" [value]="transactionsPage.content"
                         sortMode="single"
                         selectionMode="single"
                         [lazy]="true"
                         sortField="created"
                         [rows]="rowsPerPage[0]" [totalRecords]="transactionsPage.totalElements" [rowsPerPageOptions]="rowsPerPage"
                         (onLazyLoad)="loadLazy($event, getCompanyTransactions)"
                         [paginator]="true"
                         [responsive]="true">

              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th pSortableColumn="id">
                    Id
                    <p-sortIcon field="id"></p-sortIcon>
                  </th>
                  <th pSortableColumn="type">
                    Type
                    <p-sortIcon field="type"></p-sortIcon>
                  </th>
                  <th pSortableColumn="description">
                    Description
                    <p-sortIcon field="description"></p-sortIcon>
                  </th>
                  <th pSortableColumn="created">
                    Created
                    <p-sortIcon field="created"></p-sortIcon>
                  </th>
                  <th pSortableColumn="amount">
                    Amount
                    <p-sortIcon field="amount"></p-sortIcon>
                  </th>
                  <th pSortableColumn="balance">
                    Balance
                    <p-sortIcon field="balance"></p-sortIcon>
                  </th>
                  <th pSortableColumn="comment">
                    Comment
                    <p-sortIcon field="comment"></p-sortIcon>
                  </th>
                  <th pSortableColumn="chargeId">
                    Charge Id
                    <p-sortIcon field="chargeId"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row let-columns="columns">
                <tr [pContextMenuRow]="row">
                  <td>
                    <span>{{row.id}}</span>
                  </td>
                  <td>
                    <span>{{row.type}}</span>
                  </td>
                  <td>
                    <span>{{row.description}}<br/>{{row.details}}</span>
                  </td>
                  <td>
                    {{row.created | date: 'MMM d, y, h:mm a' }}
                  </td>
                  <td>
                    {{row.amount / 100 | currency: 'USD'}}
                  </td>
                  <td>
                    {{row.balance / 100 | currency: 'USD'}}
                  </td>
                  <td>
                    {{row.comment}}
                  </td>
                  <td>
                    {{row.chargeId}}
                  </td>
                </tr>
              </ng-template>
            </p-table>

          </p-accordionTab>
          <p-accordionTab header="Project Requests">
            <p-table *ngIf="accordionControls[2].active" [(first)]="accordionControls[1].first" [value]="projectPage.content"
                         sortMode="single"
                         selectionMode="single"
                         [lazy]="true"
                         [loading]="loading"
                         sortField="updated"
                         [rows]="rowsPerPage[0]" [totalRecords]="projectPage.totalElements" [rowsPerPageOptions]="rowsPerPage"
                         (onLazyLoad)="loadLazy($event, getProjects)"
                         [paginator]="true"
                         [responsive]="true">

              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th pSortableColumn="id">
                    Id
                    <p-sortIcon field="id"></p-sortIcon>
                  </th>
                  <th pSortableColumn="customer.displayName">
                    Customer
                    <p-sortIcon field="customer.displayName"></p-sortIcon>
                  </th>
                  <th pSortableColumn="serviceType">
                    Service Type
                    <p-sortIcon field="serviceType"></p-sortIcon>
                  </th>
                  <th pSortableColumn="projectStatus">
                    Project Status
                    <p-sortIcon field="projectStatus"></p-sortIcon>
                  </th>
                  <th pSortableColumn="status">
                    Request Status
                    <p-sortIcon field="status"></p-sortIcon>
                  </th>
                  <th pSortableColumn="updated">
                    Updated
                    <p-sortIcon field="updated"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row let-columns="columns">
                <tr [pContextMenuRow]="row">
                  <td>
                    <span>{{row.id}}</span>
                  </td>
                  <td>
                    <span>{{row.customer.name}}</span>
                  </td>
                  <td>
                    <span>{{row.serviceType}}</span>
                  </td>
                  <td>
                    <span>{{row.projectStatus}}</span>
                  </td>
                  <td>
                    <span>{{row.status}}</span>
                  </td>
                  <td>
                    {{row.updated | date: 'MMM d, y, h:mm a' }}
                  </td>

                </tr>
              </ng-template>
            </p-table>

          </p-accordionTab>
          <p-accordionTab header="Reviews">
            <p-table *ngIf="accordionControls[3].active" [(first)]="accordionControls[2].first" [value]="reviewRating.reviews.content"
                         sortMode="single"
                         selectionMode="single"
                         [lazy]="true"
                         [loading]="loading"
                         sortField="created"
                         [rows]="rowsPerPage[0]" [totalRecords]="reviewRating.reviews.totalElements" [rowsPerPageOptions]="rowsPerPage"
                         (onLazyLoad)="loadLazy($event, getReviews)"
                         [paginator]="true"
                         [responsive]="true"
                         (onRowSelect)="selectReview($event)">

              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th pSortableColumn="id">
                    Id
                    <p-sortIcon field="id"></p-sortIcon>
                  </th>
                  <th pSortableColumn="customer.displayName">
                    Display Name
                    <p-sortIcon field="customer.displayName"></p-sortIcon>
                  </th>
                  <th pSortableColumn="score">
                    Score
                    <p-sortIcon field="score"></p-sortIcon>
                  </th>
                  <th pSortableColumn="description">
                    Description
                    <p-sortIcon field="description"></p-sortIcon>
                  </th>
                  <th pSortableColumn="created">
                    Created
                    <p-sortIcon field="created"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row let-columns="columns">
                <tr [pContextMenuRow]="row">
                  <td>
                    <span>{{row.id}}</span>
                  </td>
                  <td>
                    <span>{{row.customer.displayName}}</span>
                  </td>
                  <td>
                    {{row.score}}
                  </td>
                  <td>
                    <span>{{row.description | slice:0:25}}{{row.description.length > 25 ? '...' : ''}}</span>
                  </td>
                  <td>
                    {{row.created | date: 'MMM d, y, h:mm a' }}
                  </td>
                </tr>
              </ng-template>

            </p-table>
          </p-accordionTab>
          <p-accordionTab header="Actions log">
            <p-table *ngIf="accordionControls[4].active" [(first)]="accordionControls[3].first" [value]="companyLogsPage.content"
                         sortMode="single"
                         [rows]="rowsPerPage[0]"
                         [lazy]="true"
                         [loading]="loading"
                         sortField="created"
                         [totalRecords]="companyLogsPage.totalElements" [rowsPerPageOptions]="rowsPerPage"
                         (onLazyLoad)="loadLazy($event, getCompanyLogs)"
                         [paginator]="true"
                         [responsive]="true">

              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th pSortableColumn="id">
                    Id
                    <p-sortIcon field="id"></p-sortIcon>
                  </th>
                  <th pSortableColumn="author">
                    Author
                    <p-sortIcon field="author"></p-sortIcon>
                  </th>
                  <th pSortableColumn="text">
                    Text
                    <p-sortIcon field="text"></p-sortIcon>
                  </th>
                  <th pSortableColumn="created">
                    Created
                    <p-sortIcon field="created"></p-sortIcon>
                  </th>
                  <th pSortableColumn="action">
                    Action
                    <p-sortIcon field="action"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-row let-columns="columns">
                <tr [pContextMenuRow]="row">
                  <td>
                    <span>{{row.id}}</span>
                  </td>
                  <td>
                    <span>{{row.author}}</span>
                  </td>
                  <td>
                    <span>{{row.text}}</span>
                  </td>
                  <td>
                    {{row.created | date: 'MMM d, y, h:mm a' }}
                  </td>
                  <td>
                    <span>{{row.action}}</span>
                  </td>
                </tr>
              </ng-template>

            </p-table>
          </p-accordionTab>
        </p-accordion>
      </div>
    </div>
  </div>
</ng-container>

<p-dialog header="Review" [(visible)]="reviewDialogToggle" showEffect="fade"
          [modal]="true">
  <div class="ui-grid ui-grid-responsive ui-fluid" *ngIf="selectedReview">
    <div class="ui-grid-row ui-grid-space">
      <div class="ui-grid-col-4">Icon</div>
      <div class="ui-grid-col-8"><span class="icon"
                                       [ngStyle]="{'background-image': 'url('+selectedReview.customer.iconUrl+')'}"></span>
      </div>
    </div>
    <div class="ui-grid-row ui-grid-space">
      <div class="ui-grid-col-4">Author</div>
      <div class="ui-grid-col-8">{{selectedReview.customer.name}}</div>
    </div>
    <div class="ui-grid-row ui-grid-space">
      <div class="ui-grid-col-4">Score</div>
      <div class="ui-grid-col-8">{{selectedReview.score}}</div>
    </div>
    <div class="ui-grid-row ui-grid-space">
      <div class="ui-grid-col-4">Created</div>
      <div class="ui-grid-col-8">{{selectedReview.created | date: 'MMM d, y, h:mm a' }}</div>
    </div>

    <div class="ui-grid-row ui-grid-space">
      <div class="ui-grid-col-4">Description</div>
      <div class="ui-grid-col-8">{{selectedReview.description }}</div>
    </div>

  </div>
</p-dialog>
