<div class="panel-header">
  <h1>Reviews</h1>
  <p-button (onClick)="refresh()" icon="pi pi-fw pi-refresh" label="&nbsp;&nbsp;Refresh"></p-button>
</div>

<p-dataTable class="reviews-table" [lazy]="true" [loading]="processing" #dt
             [value]="reviews.content"
             selectionMode="single" sortMode="single"
             [responsive]="true" [contextMenu]="cm" [paginator]="true"
             [rows]="rowsPerPage[0]" [totalRecords]="reviews.totalElements" [rowsPerPageOptions]="rowsPerPage"
             sortField="id" [sortOrder]="1"
             (onContextMenuSelect)="selectItem($event)"
             (onLazyLoad)="loadLazy($event)" [expandableRows]="true" (onRowSelect)="expandRow($event)">
  <p-header>
    <div style="text-align:left">
      <p-multiSelect [options]="tableColumns" [panelStyle]="{minWidth:'270px'}" [(ngModel)]="selectedTableCols"></p-multiSelect>
    </div>
  </p-header>
  <p-column field="id" header="ID" [sortable]="true" *ngIf="selectedTableCols.includes('id')" [filter]="true" [style]="{'width':'80px'}"></p-column>
  <p-column field="company" header="Company" filterField="companyName" sortField="company.name"  [sortable]="true" *ngIf="selectedTableCols.includes('company')" [filter]="true">
    <ng-template let-col let-data="rowData" pTemplate="body">
      {{data[col.field].name}}
    </ng-template>
  </p-column>
  <p-column field="customer" header="Customer" filterField="customerName" sortField="customer.displayName" [sortable]="true" *ngIf="selectedTableCols.includes('customer')" [filter]="true">
    <ng-template let-col let-data="rowData" pTemplate="body">
      {{data[col.field].name}}
    </ng-template>
  </p-column>
  <p-column field="score" header="Score" *ngIf="selectedTableCols.includes('score')" [style]="{'width':'60px'}" [sortable]="true"></p-column>
  <p-column field="created" header="Created" [sortable]="true" *ngIf="selectedTableCols.includes('created')">
    <ng-template let-col let-data="rowData" pTemplate="body">
      {{data[col.field] | date: 'MMM d, y, h:mm a'}}
    </ng-template>
  </p-column>
  <p-column field="published" header="Published" [sortable]="true" sortField="published" *ngIf="selectedTableCols.includes('published')">
    <ng-template let-row="rowData" pTemplate="body">
      <i class="pi pi-check" *ngIf="row.published"></i>
      <i class="pi pi-ban" *ngIf="!row.published"></i>
    </ng-template>
  </p-column>
  <p-column field="publishDate" header="Publish Date" [sortable]="true" *ngIf="selectedTableCols.includes('publishDate')">
    <ng-template let-col let-data="rowData" pTemplate="body">
      {{data[col.field] | date: 'MMM d, y, h:mm a'}}
    </ng-template>
  </p-column>
  <p-column field="revisionRequested" header="Revision Requested" [sortable]="true" sortField="revisionRequested" *ngIf="selectedTableCols.includes('revisionRequested')">
    <ng-template let-row="rowData" pTemplate="body">
      <i class="pi pi-check" *ngIf="row.revisionRequested"></i>
      <i class="pi pi-ban" *ngIf="!row.revisionRequested"></i>
    </ng-template>
  </p-column>
  <ng-template let-data pTemplate="rowexpansion">
    <div class="ui-grid ui-grid-responsive ui-fluid">
      <div class="ui-grid-row">
        <div class="ui-grid-col-9">
          <div class="ui-grid ui-grid-responsive ui-grid-pad" style="text-align: left">
            {{data.description}}
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</p-dataTable>

<review-revision-request [(toggle)]="displayReviewRevisionDialog" [review]="selected"></review-revision-request>

<p-contextMenu #cm [model]="contextMenuItems"></p-contextMenu>
